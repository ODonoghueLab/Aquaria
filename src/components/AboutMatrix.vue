<template>
    <div id="about_matrix">
        <div id="title_0" v-if="$mq === 'laptop' || $mq === 'tablet'">
            <a  v-bind:href="'https://youtu.be/J2nWQTlJNaY'" target="_blank"><img @mouseover="activatePlay" @mouseleave="resetPlay" class='icon' id='play' v-bind:src="'/images/Play.png'" v-if="$mq === 'laptop'"/></a>
            <span id="Orgname_0" @mouseover="activateHelp" @mouseleave="resetOver">STRUCTURAL MODELS OF {{ OrganismName }} PROTEINS&nbsp;</span>
            <!-- <span id="matches_0"></span> -->
             <a  v-bind:href="'https://doi.org/10.1101/2020.07.16.207308'" target="_blank"><img @mouseover="activatePaper" @mouseleave="resetPaper" class='icon' id='paper' v-bind:src="'/images/Document.png'" v-if="$mq === 'laptop'"/></a>
            <!-- <span id="help" @mouseover="activarOver" @mousedown="showAbout" @mouseleave="resetOver" v-if="$mq === 'laptop'">?</span> -->
            <img class='icon' id='help' @mouseover="activateOver" @click="showAbout" @mouseleave="resetOver" v-bind:src="'/images/Info.png'"/>
        </div>
        <div id="title_0" v-if="$mq === 'mobile'" @mousedown="showAboutPhone">
            <span id="Orgname_0">STRUCTURAL MODELS OF {{ OrganismName }} PROTEINS&nbsp;</span>
            <!-- <span id="matches_0"></span> -->
            <!-- <span class='icon' id="help">?</span> -->
            <img class='icon' id='help' @mouseover="activateOver" @click="showAbout" @mouseleave="resetOver" v-bind:src="'/images/Info.png'"/>
        </div>
        <div id="content">
            <div id="title">
                <a  v-bind:href="'https://youtu.be/J2nWQTlJNaY'" target="_blank"><img @mouseover="activatePlay" @mouseleave="resetPlay" class='icon' id='play' v-bind:src="'/images/Play.png'" v-if="$mq === 'laptop'"/></a>
                <span id="Orgname">STRUCTURAL MODELS OF {{ OrganismName }} PROTEINS&nbsp;</span>
                <!-- <span id="matches"></span> -->
                <a  v-bind:href="'https://doi.org/10.1101/2020.07.16.207308'" target="_blank"><img @mouseover="activatePaper" @mouseleave="resetPaper" class='icon' id='paper' v-bind:src="'/images/Document.png'" v-if="$mq === 'laptop'"/></a>
                <!-- <span id="close" @click="hideAbout()">âœ•</span> -->
                <img class='icon' id='close' @mouseover="activateClose" @mouseleave="resetClose" @click="hideAbout()" v-bind:src="'/images/Close.png'"/>
            </div>
            <p>This page summarizes currently available 3D structural information for all proteins believed to comprise
              <a v-bind:href="redirect(this.synonymsArray[0])" target="_blank"> {{ OrganismName }} </a>
              (a.k.a. {{ this.synonymsString }} ).
            </p>
            <p>For each protein, structural models were generated by finding all sequence regions with detectable similarity to any currently published 3D structure (in the <a href="https://www.wwpdb.org/">PDB</a>), based on a systematic, machine-learning search method (<a href="https://www.nature.com/articles/nmeth.3258">O'Donoghue et al., Nature Methods 2015</a>).</p>
            <p>For proteins with at least one match structure, an image of the best match (based on sequence identity) is shown.</p>
            <p>Click on an image to access all matching structures for that protein, and to overlay sequence features (e.g., domains, SNPs, PTMs).</p>
            <p>Proteins with no matching structure have no detectable sequence homology to any experimentally-determined 3D structure currently published (in the <a href="https://www.wwpdb.org/">PDB</a>). However, as new structures become publicly available, they will be added to this page.</p>
            <p>Learn more:
              <br/>
              <a  v-bind:href="'https://youtu.be/J2nWQTlJNaY'" target="_blank">Watch the introductory video</a>
              <br/>
              <a  v-bind:href="'https://doi.org/10.1101/2020.07.16.207308'" target="_blank">Read our bioRxiv preprint</a></p>
        </div>
    </div>
</template>

<script>
import store from '@/store/index'

export default {
  name: 'AboutMatrix',
  computed: {
    data () {
      return store.state.message
    }
  },
  data () {
    return {
      synonymsString: null,
      synonymsArray: null,
      timer: null
    }
  },
  beforeMount () {
    this.synonymsArray = this.OrgSynonyms.split(',')
    this.synonymsString = this.synonymsArray[1]
    for (var i = 2; i < this.synonymsArray.length; i++) {
      this.synonymsString = this.synonymsString + ', ' + this.synonymsArray[i]
    }
  },
  props: ['OrganismName', 'OrgSynonyms', 'checkDevice'],
  mounted () {
    document.querySelector('img#play').addEventListener('mouseover', function () {
      document.querySelector('img#play').src = '/images/Play_Hover.png'
    })
    document.querySelector('img#play').addEventListener('mouseout', function () {
      document.querySelector('img#play').src = '/images/Play.png'
    })
    document.querySelector('img#paper').addEventListener('mouseover', function () {
      document.querySelector('img#paper').src = '/images/Document_Hover.png'
    })
    document.querySelector('img#paper').addEventListener('mouseout', function () {
      document.querySelector('img#paper').src = '/images/Document.png'
    })
  },
  methods: {
    activatePlay () {
      document.querySelector('#help').src = '/images/Info.png'
      document.querySelector('#play').src = '/images/Play_Hover.png'
      document.querySelector('#play').style.cursor = 'pointer'
    },
    activatePaper () {
      document.querySelector('#help').src = '/images/Info.png'
      document.querySelector('#paper').src = '/images/Document_Hover.png'
      document.querySelector('#paper').style.cursor = 'pointer'
    },
    resetPlay () {
      document.querySelector('#play').src = '/images/Play.png'
    },
    resetPaper () {
      document.querySelector('#paper').src = '/images/Document.png'
    },
    activateHelp () {
      document.querySelector('#help').src = '/images/Info_Hover.png'
      document.querySelector('#help').style.cursor = 'pointer'
    },
    activateClose () {
      document.querySelector('#close').src = '/images/Close_Hover.png'
      document.querySelector('#close').style.cursor = 'pointer'
    },
    resetClose () {
      document.querySelector('#close').src = '/images/Close.png'
      document.querySelector('#close').style.cursor = 'pointer'
    },
    resetOver () {
      clearTimeout(this.timer)
      document.querySelector('#help').src = '/images/Info.png'
    },
    hideAbout: function () {
      document.querySelector('#content').style.visibility = 'hidden'
      document.querySelector('div.dimmer').remove()
      setTimeout(function () { document.querySelector('#help').style.pointerEvents = 'auto' }, 1000)
      document.querySelector('#help').style.pointerEvents = 'none'
    },
    showAbout: function () {
      document.querySelector('#content').style.visibility = 'visible'
      if (document.getElementsByClassName('dimmer').length === 0) {
        var elemDiv = document.createElement('div')
        elemDiv.className = 'dimmer'
        document.body.append(elemDiv)
        document.querySelector('#content').style.visibility = 'visible'

        document.querySelector('div.dimmer').addEventListener('mouseover', function () {
          document.querySelector('#content').style.visibility = 'hidden'
          document.querySelector('div.dimmer').remove()
        })
      } else {
        document.querySelector('div.dimmer').remove()
      }
    },
    showAboutPhone: function () {
      document.querySelector('#content').style.visibility = 'visible'
      if (document.getElementsByClassName('dimmer').length === 0) {
        var elemDiv = document.createElement('div')
        elemDiv.className = 'dimmer'
        document.body.append(elemDiv)
        document.querySelector('#content').style.visibility = 'visible'

        document.querySelector('div.dimmer').addEventListener('click', function () {
          document.querySelector('#content').style.visibility = 'hidden'
          document.querySelector('div.dimmer').remove()
        })
      } else {
        document.querySelector('div.dimmer').remove()
      }
    },
    activateOver () {
      this.timer = setTimeout(function () {
        document.querySelector('#content').style.visibility = 'visible'
        if (document.getElementsByClassName('dimmer').length === 0) {
          var elemDiv = document.createElement('div')
          elemDiv.className = 'dimmer'
          document.body.append(elemDiv)
          document.querySelector('#content').style.visibility = 'visible'

          document.querySelector('div.dimmer').addEventListener('mouseover', function () {
            document.querySelector('#content').style.visibility = 'hidden'
            document.querySelector('div.dimmer').remove()
          })
        } else {
          document.querySelector('div.dimmer').remove()
        }
      }, 1000)
      document.querySelector('#help').src = '/images/Info_Hover.png'
      document.querySelector('#help').style.cursor = 'pointer'
    },
    redirect: function (OrganismID) {
      var url = 'https://www.uniprot.org/taxonomy/' + OrganismID
      return (url)
    }
  }
}
</script>

<style scoped>
#help, #close, #paper{
  padding-left: 0px;
}
img.icon{
  height: calc(15px + 0.9vw);
  position: relative;
  top: calc(-1px + 0.001vh)
}
img#play{
    padding-right: 4px;
}
#about_matrix{
    margin-left: 12px;
    margin-top: calc(1px + 1.5vh);
    margin-bottom: 20px;
}

@media only screen
  and (min-width : 100px)
  and (max-width : 700px) {
    #about_matrix{
    margin-left: calc(32px + 0.8vw);
  }
}

#title, #title_0{
    display: inline-table;
    align-items: baseline;
    border-radius: 5em;
    background: #999999;
    padding: 5px calc(4px + 0.4vw)
}

#title{
  margin-top: 7px;
}

#content {
    position: absolute;
    z-index: 4;
    visibility: hidden;
    border-radius: 2em;
    background: #DEDEDE;
    top: 10px;
    left: 33%;
    right: 33%;
    padding: 8px calc(10px + 0.4vw) 20px calc(10px + 0.4vw);
    width: 44%;
    max-height: 90vh;
    overflow: auto;
}
#content p {
    text-align: left;
    width: 90%;
    margin: 0.8em auto;
    line-height: 1.65em;
}
#Orgname, #Orgname_0 {
    color: #fff;
    font-size: calc(8px + 0.6vw);
    font-weight: 500;
    vertical-align: middle;
}

#matches, #matches_0 {
    font-size: calc(10px + 0.4vw);
}

/* #help, #close {
    border-radius: 50%;
    background-color: #808080;
    width: calc(10px + .8vw);
    height: calc(10px + .8vw);
    font-size: calc(10px + .4vw);
    margin: 0px 0px 0px 4px;
    line-height: calc(11px + 1vw);
    color: #999999;
    font-weight: 900;
} */

/* #close:hover, #help:hover {
  background-color:#bebebe;
  color: #fe941a;
  cursor: pointer;
} */

/* iPhone SE */
@media only screen
  and (min-width : 200px)
  and (max-height : 600px) {
  #Orgname, #Orgname_0 {
    color: #fff;
    font-size: calc(6px + 0.8vw);
    font-weight: 500;
}
  #matches {
    font-size: calc(7px + 0.5vw);
  }
  #title_0 {
    padding: 5px calc(3px + 0.4vw);
  }
  #title{
    padding: 5px calc(9px + 0.4);
  }
  #content{
    left: 5%;
    right: 5%;
    width: 90%;
  }
  #about_matrix{
    margin-bottom: 15px;
  }
}

/* Tall aspect ratio */
    @media (max-aspect-ratio: 3/4) {
        #content{
          font-size: 10px;
          /* left: 5%;
          right: 5%;
          width: 90%; */
          left: 18%;
          width: 65%;
        }
    }
    @media (max-aspect-ratio: 3/4) and (min-height: 1000px) {
        #content{
            font-size: 12px;
        }
    }
    @media screen and (min-width: 320px) {
      #content {
          /* font-size: calc(8px + 7 * ((100vw - 320px) / 680)); */
          font-size: calc(9px + 0.5vw);
      }
    }
    @media screen and (min-width: 1000px) {
        #content {
            font-size: 16px;
        }
    }
    @media (min-width: 590px) and (max-width: 1000px) {
        #content{
            font-size: calc(8px + 0.8vw);
            left: 25%;
            right: 25%;
            width: 50%;
        }
    }
</style>
